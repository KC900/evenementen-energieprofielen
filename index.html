<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verbruiksprofielen Evenementen - Interactieve Analyse</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; min-height: 100vh; }
        .container { max-width: 1400px; margin: 0 auto; background: white; padding: 32px; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .header { text-align: center; margin-bottom: 32px; }
        h1 { font-size: 32px; margin-bottom: 8px; color: #1f2937; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .subtitle { color: #6b7280; font-size: 16px; }
        .buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 32px; }
        .btn { padding: 16px; border-radius: 12px; border: 3px solid #e5e7eb; background: white; cursor: pointer; font-size: 15px; font-weight: 600; transition: all 0.3s ease; position: relative; overflow: hidden; }
        .btn:hover { border-color: #9ca3af; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .btn.active { box-shadow: 0 8px 16px rgba(0,0,0,0.15); transform: translateY(-2px); }
        .btn.active::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: currentColor; }
        .info { padding: 24px; border-radius: 12px; margin-bottom: 24px; border-left: 6px solid; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .info h3 { font-size: 24px; font-weight: bold; margin-bottom: 12px; }
        .info p { color: #374151; margin-bottom: 16px; line-height: 1.6; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; }
        .stat-item { background: rgba(0,0,0,0.02); padding: 12px; border-radius: 8px; }
        .stat-label { font-size: 12px; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; }
        .stat-value { font-size: 18px; font-weight: bold; color: #1f2937; }
        .chart-section { background: #f9fafb; padding: 24px; border-radius: 12px; margin-bottom: 24px; position: relative; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); }
        .chart-title { font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #374151; }
        canvas { width: 100%; height: 450px; display: block; cursor: crosshair; border-radius: 8px; }
        .tooltip {
            position: absolute;
            background: white;
            border: 3px solid;
            border-radius: 12px;
            padding: 16px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
            font-size: 14px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 10;
            min-width: 220px;
        }
        .tooltip.show { opacity: 1; }
        .tooltip-header { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 2px solid; }
        .tooltip-time { font-weight: bold; font-size: 18px; }
        .tooltip-row { display: flex; justify-content: space-between; margin-bottom: 8px; align-items: center; }
        .tooltip-label { color: #6b7280; font-size: 13px; }
        .tooltip-value { font-weight: bold; font-size: 15px; }
        .tooltip-context { margin-top: 12px; padding-top: 12px; border-top: 1px solid #e5e7eb; font-size: 12px; color: #6b7280; font-style: italic; line-height: 1.4; }
        .tooltip-badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; color: white; }
        .legend-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; margin-bottom: 24px; }
        .legend-box { background: #f9fafb; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .legend-title { font-weight: 600; margin-bottom: 12px; font-size: 16px; color: #1f2937; }
        .legend-item { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .color-box { width: 20px; height: 20px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .note { margin-top: 24px; padding: 20px; background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%); border-left: 6px solid #3b82f6; border-radius: 12px; }
        .note p { color: #1e40af; line-height: 1.6; }
        ul { list-style: none; padding: 0; }
        li { color: #374151; margin-bottom: 8px; padding-left: 8px; border-left: 3px solid transparent; transition: all 0.2s; }
        li:hover { border-left-color: currentColor; padding-left: 12px; }
        .stats-summary { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 12px; }
        .stats-summary-item { text-align: center; padding: 12px; background: rgba(0,0,0,0.02); border-radius: 8px; }
        .stats-summary-label { font-size: 11px; color: #6b7280; text-transform: uppercase; margin-bottom: 4px; }
        .stats-summary-value { font-size: 20px; font-weight: bold; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.4s ease; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Typische Verbruiksprofielen Evenementen</h1>
            <p class="subtitle">Uitgebreide interactieve analyse van energieverbruik per eventtype - Beweeg over de grafiek voor gedetailleerde informatie</p>
        </div>
        
        <div class="buttons" id="buttons"></div>
        <div id="info"></div>
        
        <div class="chart-section">
            <div class="chart-title">Verbruiksprofiel over tijd</div>
            <canvas id="chart"></canvas>
            <div class="tooltip" id="tooltip">
                <div class="tooltip-header" id="tooltipHeader">
                    <div style="width: 12px; height: 12px; border-radius: 50%;" id="tooltipDot"></div>
                    <div class="tooltip-time" id="tooltipTime"></div>
                </div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Verbruik:</span>
                    <span class="tooltip-value" id="tooltipValue"></span>
                </div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Capaciteit:</span>
                    <span class="tooltip-value" id="tooltipCapacity"></span>
                </div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Belasting:</span>
                    <span class="tooltip-value" id="tooltipLoad"></span>
                </div>
                <div class="tooltip-context" id="tooltipContext"></div>
            </div>
        </div>
        
        <div class="legend-grid">
            <div class="legend-box">
                <h4 class="legend-title">Legenda</h4>
                <div class="legend-item">
                    <div class="color-box" id="legendColor"></div>
                    <span><strong>Werkelijk verbruik</strong> - Gemeten energieverbruik op elk moment</span>
                </div>
                <div class="legend-item">
                    <div style="width:40px;height:3px;background:repeating-linear-gradient(to right,#dc2626 0,#dc2626 6px,transparent 6px,transparent 12px);border-radius:2px;"></div>
                    <span><strong>Geinstalleerde capaciteit</strong> - Maximum beschikbaar vermogen</span>
                </div>
                <div class="stats-summary" id="statsSummary"></div>
            </div>
            
            <div class="legend-box">
                <h4 class="legend-title">Belangrijke observaties</h4>
                <ul id="obs"></ul>
            </div>
        </div>
        
        <div class="note">
            <p><strong>ðŸ“Š Methodologie:</strong> Deze profielen zijn gebaseerd op uitgebreide metingen en waarnemingen uit de evenementensector. Werkelijke verbruikspatronen kunnen aanzienlijk varieren afhankelijk van specifieke programmering, weersomstandigheden, publieksdrukte, technische setup, en lokale omstandigheden. De getoonde belastingsfactoren illustreren karakteristieke verschillen tussen eventtypes en dienen als indicatieve richtlijn voor energieplanning.</p>
        </div>
    </div>

    <script>
        var data={
            festival:{
                name:'Grootschalig Festival',
                desc:'Extreem dynamisch profiel gekenmerkt door zeer hoge pieken tijdens hoofdacts en zeer lage dalen tijdens nachtelijke uren',
                color:'#8b5cf6',
                points:[180,150,140,160,200,280,350,450,520,650,680,750,850,950,1200,1450,1850,2100,2050,1950,1700,1400,900,600],
                times:['00:00','01:00','02:00','03:00','04:00','05:00','06:00','07:00','08:00','09:00','10:00','11:00','12:00','13:00','14:00','15:00','16:00','17:00','18:00','19:00','20:00','21:00','22:00','23:00'],
                contexts:['Minimaal sluimerverbruik','Diep nachtelijk dal','Nacht - minimum belasting','Vroege ochtend','Opbouw intensiveert','Crew arriveert','Soundchecks beginnen','Technische voorbereidingen','Opbouw in volle gang','Pre-opening checks','Poorten openen','Eerste bezoekers','Lunch rush horeca','Middagprogramma','Eerste main stage acts','Oplopende drukte','Pre-headliner piek','Avondprogramma volop','Hoofdact voorbereiding','Maximum piek - headliner','Post-headliner','Closing show','Afbouw begint','Late night wind-down'],
                max:2500,
                load:'25-30%',
                obs:['Extreme variatie: factor 15x verschil tussen minimum en maximum','Geinstalleerd vermogen volledig gedimensioneerd op evening peak','Zeer lage gemiddelde belasting door lange periodes van minimaal gebruik','Het merendeel van de tijd wordt operatie op inefficiente lage deellast uitgevoerd','Hoofdverbruikers tijdens piek: podiumverlichting en LED-schermen']
            },
            kerstmarkt:{
                name:'Kerstmarkt met IJspiste',
                desc:'Relatief constant profiel met continue baseload door koeling van ijspiste, gecombineerd met dag/nacht cyclus voor verlichting en horeca',
                color:'#06b6d4',
                points:[420,410,405,408,420,430,450,480,520,550,600,650,680,720,750,800,850,880,920,900,880,820,650,480],
                times:['00:00','01:00','02:00','03:00','04:00','05:00','06:00','07:00','08:00','09:00','10:00','11:00','12:00','13:00','14:00','15:00','16:00','17:00','18:00','19:00','20:00','21:00','22:00','23:00'],
                contexts:['Continue koeling ijsbaan','Nacht - minimale verlichting','Onderhoud periode','Pre-dawn minimum','Ochtendvoorbereiding','Crew arrival','Opening voorbereidingen','Eerste bezoekers','Ochtendpiek begint','Midmorgen drukte','Pre-lunch rush','Lunch high traffic','Middagpiek','Afternoon steady state','Middag continuation','Avondverlichting geactiveerd','Avonddrukte neemt toe','Peak evening traffic','Maximum avondpiek','Prime time continues','Closing time nadert','Late evening wind-down','After hours - koeling','Nachtelijke baseload'],
                max:1000,
                load:'60-70%',
                obs:['Continue baseload van 400-450 kVA door permanente koeling ijspiste (24/7)','Relatief hoge gemiddelde belasting door constante basisvraag','Voorspelbaar en repeterend dagelijks patroon met beperkte variatie','Langdurige operatie over meerdere weken verhoogt totaal energieverbruik significant','Weersafhankelijkheid: hogere koelvraag tijdens mildere temperaturen']
            },
            feestmarkt:{
                name:'Feestmarkt/Braderij',
                desc:'Gemiddeld dynamisch profiel met constante baseload van kraampjes en horeca, onderbroken door pieken tijdens podiumactiviteiten',
                color:'#f59e0b',
                points:[0,0,0,0,0,0,0,80,120,180,240,280,320,420,380,320,400,480,500,520,580,550,450,280,120],
                times:['00:00','01:00','02:00','03:00','04:00','05:00','06:00','07:00','08:00','09:00','10:00','11:00','12:00','13:00','14:00','15:00','16:00','17:00','18:00','19:00','20:00','21:00','22:00','23:00','24:00'],
                contexts:['Buiten bedrijf','Nacht','Nacht','Nacht','Nacht','Nacht','Pre-setup','Opbouw kraampjes begint','Setup continues','Opening - kraampjes operationeel','Early morning traffic','Midmorgen steady','Lunch periode','Podiumact 1 - piek','Tussen acts - dip','Afternoon baseline','Pre-evening buildup','Podiumact 2 - verlichting actief','Avondprogramma opbouw','Hoofdact voorbereiding','Maximum piek - hoofdact','Prime time continues','Afbouw activiteiten','Late afbouw','Einde operatie'],
                max:650,
                load:'50-60%',
                obs:['Gematigde fluctuaties met voorspelbare patronen gedurende de dag','Duidelijke correlatie tussen pieken en geplande podiumactiviteiten','Constante baseload van 200-300 kVA door kraampjes en horeca-units','Gemiddelde belasting 50-60% door combinatie van steady baseline en peaks','Verspreid over groot gebied: meerdere verdeelpunten en bekabelingstrajecten']
            },
            kleinschalig:{
                name:'Kleinschalig Lokaal Evenement',
                desc:'Eenvoudig en compact profiel met beperkte variatie en enkele duidelijke piek tijdens de hoofdactiviteit',
                color:'#10b981',
                points:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15,25,35,55,65,85,95,110,105,85,65,40,25,10],
                times:['00:00','01:00','02:00','03:00','04:00','05:00','06:00','07:00','08:00','09:00','10:00','11:00','12:00','13:00','14:00','15:00','16:00','17:00','17:30','18:00','18:30','19:00','19:30','20:00','20:30','21:00','21:30','22:00','22:30','23:00','23:30'],
                contexts:['Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Opbouw start','Setup continues','Basis systemen online','Geluid test','Pre-event checks','Deuren open - publiek arriveert','Early program','Hoofdact voorbereiding','PIEK - hoofdact','Post-main performance','Wind-down fase','Afbouw activiteiten','Late opruiming','Einde - systemen uit'],
                max:150,
                load:'60-75%',
                obs:['Eenvoudig, zeer voorspelbaar profiel met beperkte complexiteit','Zeer korte operationele duur van slechts enkele uren','Vaak overgedimensioneerd uit voorzorg voor piekmomenten','Relatief hoge gemiddelde belasting tijdens actieve periode door korte duur','Nabijheid bewoning: geluid en emissies zijn primaire constraints']
            },
            mobiel:{
                name:'Mobiel Evenement (Optocht)',
                desc:'Uniek constant verbruiksprofiel tijdens verplaatsing door de stad, zonder mogelijkheid tot externe aansluitingen',
                color:'#ec4899',
                points:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,42,44,45,44,43,46,45,44,45,44,43,42,5,0],
                times:['00:00','01:00','02:00','03:00','04:00','05:00','06:00','07:00','08:00','09:00','10:00','11:00','12:00','13:00','14:00','15:00','16:00','17:00','17:30','18:00','18:15','18:30','18:45','19:00','19:15','19:30','19:45','20:00','20:15','20:30','20:45','21:00','21:30'],
                contexts:['Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Niet actief','Pre-departure prep','Systemen activeren','Vertrek - route start','Optocht in beweging','Constant tijdens route','Steady state','Mid-route','Continues','Route progression','Steady operation','Finale approach','Last segment','Eindpunt nadert','Arrival','Systemen deactiveren','Volledige shutdown'],
                max:50,
                load:'85-95%',
                obs:['Extreem constant verbruik tijdens volledige verplaatsingsduur','Zeer hoge belasting ratio (85-95%) ten opzichte van beschikbare capaciteit','Beperkte totale operationele duur maar hoge intensiteit','Autonomie absoluut cruciaal: geen externe voeding mogelijk tijdens route','Absolute geluisloosheid vereist door continue directe nabijheid publiek tijdens verplaatsing']
            }
        };
        
        var cur='festival';
        var canvas=document.getElementById('chart');
        var ctx=canvas.getContext('2d');
        var tooltip=document.getElementById('tooltip');
        var hoverIndex=-1;
        
        function hexToRgb(hex){return[parseInt(hex.slice(1,3),16),parseInt(hex.slice(3,5),16),parseInt(hex.slice(5,7),16)];}
        
        function getStats(points){
            var sum=0;
            var min=Infinity;
            var max=-Infinity;
            for(var i=0;i<points.length;i++){
                sum+=points[i];
                if(points[i]<min)min=points[i];
                if(points[i]>max)max=points[i];
            }
            return{avg:Math.round(sum/points.length),min:min,max:max};
        }
        
        function draw(highlightIndex){
            var d=data[cur];
            var w=canvas.width=canvas.offsetWidth*2;
            var h=canvas.height=900;
            var pad=100;
            var cw=w-pad*2;
            var ch=h-pad*2;
            
            ctx.clearRect(0,0,w,h);
            
            var gradient=ctx.createLinearGradient(0,0,0,h);
            gradient.addColorStop(0,'#fafafa');
            gradient.addColorStop(1,'#f3f4f6');
            ctx.fillStyle=gradient;
            ctx.fillRect(0,0,w,h);
            
            var maxY=Math.max(d.max,Math.max.apply(null,d.points))*1.15;
            var stepX=cw/(d.points.length-1);
            
            ctx.strokeStyle='#e5e7eb';
            ctx.lineWidth=2;
            for(var i=0;i<=10;i++){
                var y=pad+(ch/10)*i;
                ctx.beginPath();
                ctx.moveTo(pad,y);
                ctx.lineTo(w-pad,y);
                ctx.stroke();
            }
            
            ctx.strokeStyle='#d1d5db';
            ctx.lineWidth=1;
            for(var i=0;i<d.points.length;i+=3){
                var x=pad+stepX*i;
                ctx.beginPath();
                ctx.moveTo(x,pad);
                ctx.lineTo(x,h-pad);
                ctx.stroke();
            }
            
            ctx.fillStyle='#4b5563';
            ctx.font='bold 28px Arial';
            ctx.textAlign='right';
            for(var i=0;i<=10;i++){
                var y=pad+(ch/10)*i;
                var val=Math.round(maxY-(maxY/10)*i);
                ctx.fillText(val,pad-15,y+10);
            }
            
            ctx.fillStyle='#1f2937';
            ctx.font='bold 32px Arial';
            ctx.textAlign='center';
            ctx.save();
            ctx.translate(35,h/2);
            ctx.rotate(-Math.PI/2);
            ctx.fillText('Vermogen (kVA)',0,0);
            ctx.restore();
            
            var rgb=hexToRgb(d.color);
            var areaGradient=ctx.createLinearGradient(0,pad,0,h-pad);
            areaGradient.addColorStop(0,'rgba('+rgb[0]+','+rgb[1]+','+rgb[2]+',0.3)');
            areaGradient.addColorStop(1,'rgba('+rgb[0]+','+rgb[1]+','+rgb[2]+',0.05)');
            ctx.fillStyle=areaGradient;
            ctx.beginPath();
            ctx.moveTo(pad,h-pad);
            for(var i=0;i<d.points.length;i++){
                var x=pad+stepX*i;
                var y=h-pad-(d.points[i]/maxY)*ch;
                ctx.lineTo(x,y);
            }
            ctx.lineTo(w-pad,h-pad);
            ctx.closePath();
            ctx.fill();
            
            ctx.strokeStyle=d.color;
            ctx.lineWidth=8;
            ctx.lineCap='round';
            ctx.lineJoin='round';
            ctx.shadowColor='rgba(0,0,0,0.1)';
            ctx.shadowBlur=4;
            ctx.shadowOffsetY=2;
            ctx.beginPath();
            for(var i=0;i<d.points.length;i++){
                var x=pad+stepX*i;
                var y=h-pad-(d.points[i]/maxY)*ch;
                if(i===0)ctx.moveTo(x,y);
                else ctx.lineTo(x,y);
            }
            ctx.stroke();
            ctx.shadowColor='transparent';
            
            if(highlightIndex>=0&&highlightIndex<d.points.length){
                var hx=pad+stepX*highlightIndex;
                var hy=h-pad-(d.points[highlightIndex]/maxY)*ch;
                
                ctx.strokeStyle='rgba(0,0,0,0.15)';
                ctx.lineWidth=3;
                ctx.setLineDash([8,8]);
                ctx.beginPath();
                ctx.moveTo(hx,pad);
                ctx.lineTo(hx,h-pad);
                ctx.stroke();
                ctx.setLineDash([]);
                
                ctx.fillStyle='white';
                ctx.beginPath();
                ctx.arc(hx,hy,16,0,Math.PI*2);
                ctx.fill();
                ctx.strokeStyle=d.color;
                ctx.lineWidth=6;
                ctx.stroke();
                ctx.fillStyle=d.color;
                ctx.beginPath();
                ctx.arc(hx,hy,8,0,Math.PI*2);
                ctx.fill();
            }
            
            ctx.strokeStyle='#dc2626';
            ctx.lineWidth=5;
            ctx.setLineDash([12,12]);
            var capY=h-pad-(d.max/maxY)*ch;
            ctx.beginPath();
            ctx.moveTo(pad,capY);
            ctx.lineTo(w-pad,capY);
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.fillStyle='#6b7280';
            ctx.font='24px Arial';
            ctx.textAlign='center';
            for(var i=0;i<d.times.length;i+=2){
                var x=pad+stepX*i;
                ctx.fillText(d.times[i],x,h-pad+45);
            }
        }
        
        function getChartCoordinates(){
            var d=data[cur];
            var w=canvas.width;
            var pad=100;
            var cw=w-pad*2;
            var stepX=cw/(d.points.length-1);
            var coords=[];
            for(var i=0;i<d.points.length;i++){
                coords.push((pad+stepX*i)/2);
            }
            return coords;
        }
        
        canvas.addEventListener('mousemove',function(e){
            var d=data[cur];
            var rect=canvas.getBoundingClientRect();
            var mouseX=e.clientX-rect.left;
            var coords=getChartCoordinates();
            var closestIndex=-1;
            var closestDist=Infinity;
            
            for(var i=0;i<coords.length;i++){
                var dist=Math.abs(mouseX-coords[i]);
                if(dist<closestDist){
                    closestDist=dist;
                    closestIndex=i;
                }
            }
            
            if(closestDist<60){
                hoverIndex=closestIndex;
                draw(hoverIndex);
                
                var loadPct=Math.round((d.points[hoverIndex]/d.max)*100);
                var loadColor=loadPct>90?'#dc2626':loadPct>70?'#f59e0b':loadPct>50?'#3b82f6':'#10b981';
                
                document.getElementById('tooltipTime').textContent=d.times[hoverIndex];
                document.getElementById('tooltipValue').textContent=d.points[hoverIndex]+' kVA';
                document.getElementById('tooltipCapacity').textContent=d.max+' kVA';
                document.getElementById('tooltipLoad').innerHTML='<span class="tooltip-badge" style="background:'+loadColor+'">'+loadPct+'%</span>';
                document.getElementById('tooltipContext').textContent=d.contexts[hoverIndex];
                document.getElementById('tooltipDot').style.backgroundColor=d.color;
                
                var header=document.getElementById('tooltipHeader');
                header.style.borderBottomColor=d.color;
                tooltip.style.borderColor=d.color;
                
                var tooltipX=Math.min(Math.max(e.clientX-rect.left+25,0),rect.width-240);
                var tooltipY=Math.max(e.clientY-rect.top-120,10);
                tooltip.style.left=tooltipX+'px';
                tooltip.style.top=tooltipY+'px';
                tooltip.className='tooltip show';
            }else{
                hoverIndex=-1;
                draw(-1);
                tooltip.className='tooltip';
            }
        });
        
        canvas.addEventListener('mouseleave',function(){
            hoverIndex=-1;
            draw(-1);
            tooltip.className='tooltip';
        });
        
        function update(){
            var d=data[cur];
            var rgb=hexToRgb(d.color);
            var stats=getStats(d.points);
            
            var btns=document.getElementById('buttons');
            btns.innerHTML='';
            for(var key in data){
                var btn=document.createElement('button');
                btn.className='btn'+(key===cur?' active':'');
                btn.textContent=data[key].name;
                btn.style.color=key===cur?data[key].color:'#374151';
                btn.style.borderColor=key===cur?data[key].color:'#e5e7eb';
                btn.style.backgroundColor=key===cur?'rgba('+hexToRgb(data[key].color).join(',')+',0.1)':'white';
                btn.onclick=(function(k){return function(){cur=k;hoverIndex=-1;tooltip.className='tooltip';update();};})(key);
                btns.appendChild(btn);
            }
            
            var info=document.getElementById('info');
            info.className='info animate-in';
            info.style.backgroundColor='rgba('+rgb.join(',')+',0.08)';
            info.style.borderColor=d.color;
            info.innerHTML='<h3 style="color:'+d.color+'">'+d.name+'</h3><p>'+d.desc+'</p><div class="stats"><div class="stat-item"><div class="stat-label">Max Capaciteit</div><div class="stat-value">'+d.max+' kVA</div></div><div class="stat-item"><div class="stat-label">Gem. Belasting</div><div class="stat-value">'+d.load+'</div></div><div class="stat-item"><div class="stat-label">Datapunten</div><div class="stat-value">'+d.points.length+'</div></div></div>';
            
            document.getElementById('legendColor').style.backgroundColor=d.color;
            
            var summary=document.getElementById('statsSummary');
            summary.innerHTML='<div class="stats-summary-item"><div class="stats-summary-label">Gemiddeld</div><div class="stats-summary-value" style="color:'+d.color+'">'+stats.avg+' kVA</div></div><div class="stats-summary-item"><div class="stats-summary-label">Minimum</div><div class="stats-summary-value" style="color:#10b981">'+stats.min+' kVA</div></div><div class="stats-summary-item"><div class="stats-summary-label">Maximum</div><div class="stats-summary-value" style="color:#dc2626">'+stats.max+' kVA</div></div>';
            
            var obs=document.getElementById('obs');
            obs.innerHTML='';
            for(var i=0;i<d.obs.length;i++){
                var li=document.createElement('li');
                li.textContent='â€¢ '+d.obs[i];
                li.style.color=d.color;
                obs.appendChild(li);
            }
            
            draw(-1);
        }
        
        window.onresize=function(){draw(hoverIndex);};
        update();
    </script>
</body>
</html>
